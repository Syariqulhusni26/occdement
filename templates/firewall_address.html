<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Device Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>

{% extends "base.html" %}
{% block content %}

<!-- ==================== ADDRESS LIST ==================== -->
<h2>Firewall Address List</h2>

<!-- Tombol buka modal -->
<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addIpModal">
    Tambah IP
    </button>

    <!-- Modal Tambah IP -->
    <div class="modal fade" id="addIpModal" tabindex="-1" aria-labelledby="addIpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        <form action="{{ url_for('address_list_add') }}" method="POST">
            <div class="modal-header">
            <h5 class="modal-title" id="addIpModalLabel">Tambah IP Address</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body row g-3">
            <div class="col-md-12">
                <label class="form-label">IP Address</label>
                <input type="text" name="ip" class="form-control" placeholder="192.168.1.x" required>
            </div>
            <div class="col-md-12">
                <label class="form-label">Kategori</label>
                <select name="category" class="form-select">
                <option value="ALLOWED">ALLOWED</option>
                <option value="BLOCKED">BLOCKED</option>
                </select>
            </div>
            <div class="col-md-12">
                <label class="form-label">Comment</label>
                <input type="text" name="comment" class="form-control" placeholder="Keterangan (opsional)">
            </div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-primary">Simpan</button>
            </div>
        </form>
        </div>
    </div>
    </div>

    <!-- Tabel Address List -->
    <table class="table table-bordered table-striped align-middle">
    <thead class="table-primary">
        <tr>
        <th>IP</th>
        <th>List</th>
        <th>Comment</th>
        <th>Aksi</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in address_list %}
        <tr>
            <td>{{ entry.address }}</td>
            <td>{{ entry.list }}</td>
            <td>{{ entry.comment }}</td>
            <td>
            <form method="POST" action="{{ url_for('toggle_address_fallback') }}" style="display:inline;">
                <input type="hidden" name="entry_id" value="{{ entry.id or '' }}">
                <input type="hidden" name="address" value="{{ entry.address }}">
                <input type="hidden" name="list" value="{{ entry.list }}">
                <button type="submit" 
                        class="btn {% if entry.list == 'BLOCKED' %}btn-success{% else %}btn-secondary{% endif %}">
                {% if entry.list == 'BLOCKED' %} Enable {% else %} Disable {% endif %}
                </button>
            </form>

            <form action="{{ url_for('delete_address_fallback') }}" method="post" style="display:inline;">
                <input type="hidden" name="entry_id" value="{{ entry['id'] }}">
                <input type="hidden" name="address" value="{{ entry['address'] }}">
                <input type="hidden" name="list" value="{{ entry['list'] }}">
                <button type="submit" class="btn btn-danger"
                onclick="return confirm('Yakin mau hapus {{ entry['address'] }}?');">
                Delete
                </button>
            </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>


{% if address_list|length == 0 %}
<div class="alert alert-info">Belum ada data di Address List.</div>
{% endif %}


<script>
async function lihatJaringan() {
    alert("Sedang mengambil data jaringan..."); // pop up muncul duluan
    document.getElementById("hasil").textContent = "Loading...";
    try {
        let res = await fetch("/api/networks");
        let data = await res.json();
        document.getElementById("hasil").textContent = JSON.stringify(data, null, 2);
        alert("Data jaringan berhasil diambil!");
    } catch (err) {
        console.error("Error:", err);
        document.getElementById("hasil").textContent = "Error: " + err;
        alert("Terjadi error saat mengambil data jaringan");
    }
}
</script>

{% endblock %}
</body>
</html>
