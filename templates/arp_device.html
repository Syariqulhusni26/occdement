<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Device Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>

{% extends "base.html" %}
{% block content %}

<!-- ==================== ARP LIST ==================== -->
<h2>Daftar Perangkat Terdeteksi (ARP Mikrotik)</h2>
<table class="table table-bordered table-striped align-middle">
    <thead class="table-primary">
    <tr>
        <th>IP</th>
        <th>MAC</th>
        <th>Status</th>
        <th>Aksi</th>
    </tr>
    </thead>
    <tbody>
    {% for dev in arp_devices %}
    <tr>
        <td>{{ dev.ip }}</td>
        <td>{{ dev.name }}</td>
        <td>
            {% if dev.enabled %}
                ✅ Aktif
            {% else %}
                ❌ Nonaktif (Blocked)
            {% endif %}
        </td>
        <td>
            <a class="btn {% if dev.enabled %}btn-secondary{% else %}btn-success{% endif %}" 
            href="/toggle/{{ dev.ip }}">
                {% if dev.enabled %}Disable{% else %}Enable{% endif %}
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% if arp_devices|length == 0 %}
<div class="alert alert-warning">Belum ada perangkat ARP terdeteksi.</div>
{% endif %}

<button class="btn btn-secondary" onclick="lihatJaringan()">Lihat Jaringan dari Mikrotik</button>
<pre id="hasil"></pre>

<script>
async function lihatJaringan() {
    alert("Sedang mengambil data jaringan..."); // pop up muncul duluan
    document.getElementById("hasil").textContent = "Loading...";
    try {
        let res = await fetch("/api/networks");
        let data = await res.json();
        document.getElementById("hasil").textContent = JSON.stringify(data, null, 2);
        alert("Data jaringan berhasil diambil!");
    } catch (err) {
        console.error("Error:", err);
        document.getElementById("hasil").textContent = "Error: " + err;
        alert("Terjadi error saat mengambil data jaringan");
    }
}
</script>

{% endblock %}
</body>
</html>
